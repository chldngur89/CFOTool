import { motion } from 'motion/react';

interface PixelCastleProps {
  hp: number;
}

export function PixelCastle({ hp }: PixelCastleProps) {
  // 32x32 픽셀 성
  const castlePixels = [
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0],
    [0,0,0,0,1,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,1,0,0,0,0],
    [0,0,0,0,1,2,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,2,1,0,0,0,0],
    [0,0,0,0,1,2,1,0,0,0,1,3,3,3,3,3,3,3,3,3,3,1,0,0,0,1,2,1,0,0,0,0],
    [0,0,1,1,1,2,1,1,1,1,1,3,3,3,3,3,3,3,3,3,3,1,1,1,1,1,2,1,1,1,0,0],
    [0,0,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,1,0,0],
    [0,0,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,1,0,0],
    [0,0,1,2,2,1,1,2,2,1,1,3,3,3,3,3,3,3,3,3,3,1,1,2,2,1,1,2,2,1,0,0],
    [0,0,1,2,2,1,1,2,2,1,1,3,3,3,3,3,3,3,3,3,3,1,1,2,2,1,1,2,2,1,0,0],
    [0,0,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,1,0,0],
    [0,0,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,1,0,0],
    [0,0,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,1,0,0],
    [0,0,1,2,2,1,1,2,2,1,1,3,3,3,3,3,3,3,3,3,3,1,1,2,2,1,1,2,2,1,0,0],
    [0,0,1,2,2,1,1,2,2,1,1,3,3,3,3,3,3,3,3,3,3,1,1,2,2,1,1,2,2,1,0,0],
    [0,0,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,1,0,0],
    [0,0,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,1,0,0],
    [0,0,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,1,0,0],
    [0,0,1,2,2,1,1,2,2,1,1,3,3,3,3,3,3,3,3,3,3,1,1,2,2,1,1,2,2,1,0,0],
    [0,0,1,2,2,1,1,2,2,1,1,3,3,3,3,3,3,3,3,3,3,1,1,2,2,1,1,2,2,1,0,0],
    [0,0,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,1,0,0],
    [0,0,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,1,0,0],
    [0,0,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,0,0],
    [0,0,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,0,0],
    [0,0,1,2,2,2,2,2,2,2,2,2,2,4,4,4,4,4,4,2,2,2,2,2,2,2,2,2,2,1,0,0],
    [0,0,1,2,2,2,2,2,2,2,2,2,2,4,5,5,5,5,4,2,2,2,2,2,2,2,2,2,2,1,0,0],
    [0,0,1,2,2,2,2,2,2,2,2,2,2,4,5,5,5,5,4,2,2,2,2,2,2,2,2,2,2,1,0,0],
    [0,0,1,2,2,2,2,2,2,2,2,2,2,4,5,5,5,5,4,2,2,2,2,2,2,2,2,2,2,1,0,0],
    [0,0,1,2,2,2,2,2,2,2,2,2,2,4,5,6,6,5,4,2,2,2,2,2,2,2,2,2,2,1,0,0],
    [0,0,1,2,2,2,2,2,2,2,2,2,2,4,5,5,5,5,4,2,2,2,2,2,2,2,2,2,2,1,0,0],
    [0,0,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  ];

  const getColor = (value: number) => {
    const colors: { [key: number]: string } = {
      0: 'transparent',
      1: '#000000', // 검정 윤곽선
      2: hp > 66 ? '#808080' : hp > 33 ? '#b8860b' : '#8b0000', // 성벽 (HP에 따라 변화)
      3: hp > 66 ? '#606060' : hp > 33 ? '#daa520' : '#a52a2a', // 중앙 타워
      4: '#4a2511', // 문 틀
      5: '#654321', // 문
      6: '#ffd700', // 문 손잡이
    };
    return colors[value] || 'transparent';
  };

  return (
    <motion.div
      animate={hp < 33 ? { x: [-3, 3, -3, 3, 0] } : {}}
      transition={{ duration: 0.5, repeat: hp < 33 ? Infinity : 0, repeatDelay: 2 }}
      className="inline-block relative"
      style={{ imageRendering: 'pixelated' }}
    >
      <div className="grid" style={{ 
        gridTemplateColumns: 'repeat(32, 3px)',
        gap: 0,
      }}>
        {castlePixels.flat().map((pixel, index) => (
          <div
            key={index}
            style={{
              width: '3px',
              height: '3px',
              backgroundColor: getColor(pixel),
            }}
          />
        ))}
      </div>
      
      {/* 깃발 */}
      <motion.div
        animate={{ rotate: [-5, 5, -5] }}
        transition={{ duration: 2, repeat: Infinity }}
        className="absolute"
        style={{ top: '-16px', left: '50%', transform: 'translateX(-50%)' }}
      >
        <div className="grid" style={{ 
          gridTemplateColumns: 'repeat(8, 2px)',
          gap: 0,
        }}>
          {[
            [1,1,0,0,0,0,0,0],
            [1,2,2,2,2,2,2,0],
            [1,2,2,2,2,2,2,2],
            [1,2,2,2,2,2,2,0],
            [1,1,0,0,0,0,0,0],
          ].flat().map((pixel, index) => (
            <div
              key={index}
              style={{
                width: '2px',
                height: '2px',
                backgroundColor: pixel === 1 ? '#654321' : pixel === 2 ? '#ff0000' : 'transparent',
              }}
            />
          ))}
        </div>
      </motion.div>

      {/* HP 경고 */}
      {hp < 33 && (
        <motion.div
          className="absolute -top-8 left-1/2 transform -translate-x-1/2 text-red-500 font-bold"
          animate={{ opacity: [1, 0, 1], scale: [1, 1.2, 1] }}
          transition={{ duration: 1, repeat: Infinity }}
          style={{ fontSize: '24px' }}
        >
          ⚠️
        </motion.div>
      )}
    </motion.div>
  );
}
